<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Å KODA X Events â€“ Administrace</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
:root {
  --green: #78FAAE; --green-dark: #3DDC84; --green-deep: #0E4A2E;
  --black: #0A0A0A; --d1: #111; --d2: #1A1A1A; --d3: #242424; --d4: #2E2E2E;
  --white: #FFF; --gray: #E5E5E5; --red: #EF5350; --orange: #FFB74D; --blue: #4FC3F7; --purple: #CE93D8;
  --font: 'DM Sans', sans-serif;
}
body { font-family: var(--font); background: var(--black); color: var(--white); min-height: 100vh; }
input, textarea, select, button { font-family: var(--font); }
input::placeholder, textarea::placeholder { color: rgba(255,255,255,0.25); }

/* Layout */
.header { padding: 14px 24px; background: var(--d1); border-bottom: 1px solid rgba(255,255,255,0.06); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100; }
.header-left { display: flex; align-items: center; gap: 16px; }
.logo { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--white); }
.logo-circle { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--green); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 700; color: var(--green); }
.logo-text { font-size: 16px; font-weight: 800; }
.logo-text span { color: var(--green); }
.logo-sub { font-size: 9px; color: rgba(255,255,255,0.35); text-transform: uppercase; letter-spacing: 0.15em; }
.header-sep { width: 1px; height: 24px; background: rgba(255,255,255,0.08); }
.header-title { font-size: 15px; font-weight: 800; }
.header-stats { font-size: 12px; color: rgba(255,255,255,0.3); background: var(--d3); padding: 6px 14px; border-radius: 8px; }

.container { max-width: 1020px; margin: 0 auto; padding: 28px 20px; }

/* Tabs */
.tabs { display: flex; gap: 4px; background: var(--d3); border-radius: 10px; padding: 4px; margin-bottom: 24px; }
.tab { flex: 1; padding: 10px 16px; border-radius: 8px; border: none; font-size: 13px; font-weight: 700; cursor: pointer; transition: all 0.2s; background: transparent; color: rgba(255,255,255,0.5); }
.tab.active { background: var(--green); color: var(--black); }

/* Buttons */
.btn { padding: 11px 22px; border-radius: 10px; font-size: 14px; font-weight: 700; cursor: pointer; transition: all 0.2s; border: none; display: inline-flex; align-items: center; gap: 8px; }
.btn-sm { padding: 7px 14px; font-size: 12px; border-radius: 8px; }
.btn-primary { background: linear-gradient(135deg, var(--green), var(--green-dark)); color: var(--black); box-shadow: 0 6px 24px rgba(120,250,174,0.18); }
.btn-secondary { background: var(--d3); color: var(--white); border: 1px solid rgba(255,255,255,0.08); }
.btn-danger { background: rgba(239,83,80,0.1); color: var(--red); border: 1px solid rgba(239,83,80,0.15); }
.btn-ghost { background: transparent; color: rgba(255,255,255,0.5); padding: 7px 10px; }
.btn:disabled { opacity: 0.4; cursor: not-allowed; }

/* Cards */
.event-card { background: var(--d2); border-radius: 16px; overflow: hidden; border: 1px solid rgba(255,255,255,0.04); display: flex; margin-bottom: 14px; }
.event-card-photo { width: 150px; min-height: 130px; flex-shrink: 0; object-fit: cover; }
.event-card-body { flex: 1; padding: 16px 20px; display: flex; flex-direction: column; justify-content: space-between; }
.event-card-tags { display: flex; gap: 8px; margin-bottom: 8px; flex-wrap: wrap; }
.tag { font-size: 11px; padding: 3px 10px; border-radius: 6px; font-weight: 600; }
.event-card h4 { font-size: 16px; font-weight: 800; margin-bottom: 6px; }
.event-card-meta { font-size: 12px; color: rgba(255,255,255,0.4); line-height: 1.5; }
.event-card-actions { display: flex; gap: 8px; margin-top: 12px; }

/* Registration rows */
.reg-row { background: var(--d2); border-radius: 12px; padding: 14px 18px; border: 1px solid rgba(255,255,255,0.04); margin-bottom: 8px; }
.reg-row-top { display: flex; justify-content: space-between; flex-wrap: wrap; gap: 8px; }
.reg-name { font-size: 14px; font-weight: 700; }
.reg-details { font-size: 12px; color: rgba(255,255,255,0.45); margin-top: 3px; }
.reg-event-tag { font-size: 11px; padding: 3px 8px; border-radius: 5px; font-weight: 600; }
.reg-date { font-size: 11px; color: rgba(255,255,255,0.25); margin-top: 4px; text-align: right; }
.reg-programs { display: flex; gap: 6px; flex-wrap: wrap; margin-top: 8px; }
.reg-prog-tag { font-size: 11px; background: var(--d3); padding: 3px 8px; border-radius: 5px; color: rgba(255,255,255,0.5); }

/* Filter pills */
.filters { display: flex; gap: 6px; margin-bottom: 20px; flex-wrap: wrap; }
.filter-pill { padding: 7px 14px; border-radius: 8px; border: none; font-size: 12px; font-weight: 600; cursor: pointer; background: var(--d3); color: rgba(255,255,255,0.5); transition: all 0.15s; max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.filter-pill.active { background: var(--green); color: var(--black); }

/* Empty state */
.empty { text-align: center; padding: 70px 20px; color: rgba(255,255,255,0.3); }
.empty-icon { font-size: 48px; margin-bottom: 14px; }
.empty p { font-size: 15px; margin-bottom: 20px; }

/* Modal */
.modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.8); backdrop-filter: blur(16px); z-index: 2000; overflow-y: auto; animation: fadeIn 0.2s; }
.modal { max-width: 680px; margin: 36px auto; padding: 0 16px; }
.modal-box { background: var(--d1); border-radius: 20px; border: 1px solid rgba(255,255,255,0.06); overflow: hidden; }
.modal-header { padding: 18px 24px; border-bottom: 1px solid rgba(255,255,255,0.06); display: flex; justify-content: space-between; align-items: center; }
.modal-header h3 { font-size: 17px; font-weight: 800; }
.modal-close { background: var(--d3); border: none; color: rgba(255,255,255,0.5); width: 30px; height: 30px; border-radius: 8px; cursor: pointer; font-size: 15px; }
.modal-body { padding: 22px 24px; }
.modal-footer { padding: 18px 24px; border-top: 1px solid rgba(255,255,255,0.06); display: flex; justify-content: flex-end; gap: 10px; }

/* Form elements */
.form-group { margin-bottom: 16px; }
.form-label { display: block; font-size: 11px; font-weight: 700; color: rgba(255,255,255,0.5); margin-bottom: 5px; letter-spacing: 0.08em; text-transform: uppercase; }
.form-label .req { color: var(--green); }
.form-input { width: 100%; padding: 11px 14px; background: var(--d3); border: 1px solid rgba(120,250,174,0.12); border-radius: 9px; color: var(--white); font-size: 14px; outline: none; transition: border-color 0.2s; }
.form-input:focus { border-color: var(--green); }
.form-input.error { border-color: var(--red); }
.form-error { color: var(--red); font-size: 11px; margin-top: 3px; }
.form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 0 14px; }
.form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 0 12px; }
.form-full { grid-column: 1 / -1; }

/* Type selector */
.type-options { display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 18px; }
.type-btn { padding: 9px 16px; border-radius: 10px; border: 2px solid rgba(255,255,255,0.06); background: var(--d3); cursor: pointer; font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.5); transition: all 0.2s; }
.type-btn.active { border-color: var(--green); background: rgba(120,250,174,0.06); color: var(--green); }

/* Theme selector */
.theme-options { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 24px; }
.theme-btn { padding: 10px 16px; border-radius: 12px; border: 2px solid rgba(255,255,255,0.06); background: var(--d3); cursor: pointer; display: flex; align-items: center; gap: 10px; transition: all 0.2s; }
.theme-btn.active { border-color: var(--green); background: rgba(120,250,174,0.06); }
.theme-dot { width: 16px; height: 16px; border-radius: 50%; }
.theme-name { font-size: 12px; font-weight: 600; color: rgba(255,255,255,0.5); }
.theme-btn.active .theme-name { color: var(--green); }

/* Status toggle */
.status-row { display: flex; gap: 8px; }
.status-btn { flex: 1; padding: 11px; border-radius: 9px; border: 2px solid rgba(255,255,255,0.06); background: var(--d3); cursor: pointer; font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.4); transition: all 0.2s; text-align: center; }
.status-btn.on { border-color: var(--green); background: rgba(120,250,174,0.06); color: var(--green); }
.status-btn.off { border-color: var(--orange); background: rgba(255,183,77,0.06); color: var(--orange); }

/* Field toggles */
.field-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
.field-toggle { display: flex; align-items: center; gap: 12px; padding: 11px 14px; border-radius: 10px; background: var(--d3); border: 1px solid rgba(255,255,255,0.04); cursor: pointer; transition: all 0.2s; }
.field-toggle.active { background: rgba(120,250,174,0.05); border-color: rgba(120,250,174,0.2); }
.field-check { width: 18px; height: 18px; border-radius: 5px; border: 2px solid rgba(255,255,255,0.2); display: flex; align-items: center; justify-content: center; flex-shrink: 0; font-size: 11px; font-weight: 700; transition: all 0.2s; }
.field-toggle.active .field-check { border-color: var(--green); background: var(--green); color: var(--black); }
.field-name { font-size: 13px; font-weight: 600; color: rgba(255,255,255,0.6); }

/* Program block in editor */
.prog-block { background: var(--d3); border-radius: 14px; padding: 16px 18px; margin-bottom: 10px; border: 1px solid rgba(255,255,255,0.04); position: relative; }
.prog-remove { position: absolute; top: 10px; right: 10px; }

/* Photo preview */
.photo-preview { margin-bottom: 16px; border-radius: 12px; overflow: hidden; border: 1px solid rgba(255,255,255,0.06); max-height: 160px; }
.photo-preview img { width: 100%; height: 160px; object-fit: cover; display: block; }

/* Editor inner tabs */
.editor-tabs { display: flex; gap: 4px; background: var(--d3); border-radius: 10px; padding: 4px; margin-bottom: 20px; }
.editor-tab { flex: 1; padding: 9px 14px; border-radius: 7px; border: none; font-size: 12px; font-weight: 700; cursor: pointer; transition: all 0.15s; background: transparent; color: rgba(255,255,255,0.45); text-align: center; }
.editor-tab.active { background: var(--green); color: var(--black); }

.section-top { display: flex; justify-content: space-between; align-items: center; margin-bottom: 22px; }
.section-top h3 { font-size: 20px; font-weight: 800; }

.border-left-green { border-left: 4px solid var(--green); }
.border-left-blue { border-left: 4px solid var(--blue); }
.border-left-orange { border-left: 4px solid var(--orange); }

@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

@media (max-width: 640px) {
  .event-card { flex-direction: column; }
  .event-card-photo { width: 100%; height: 140px; }
  .form-row, .form-row-3, .field-grid { grid-template-columns: 1fr; }
  .modal { margin: 16px auto; }
}
</style>
</head>
<body>

<!-- Header -->
<header class="header">
  <div class="header-left">
    <a href="index.html" class="logo">
      <div class="logo-circle">Å X</div>
      <div>
        <div class="logo-text">Å KODA <span>X</span></div>
        <div class="logo-sub">Event Admin</div>
      </div>
    </a>
    <div class="header-sep"></div>
    <div class="header-title">âš™ï¸ Administrace</div>
  </div>
  <div style="display:flex;gap:10px;align-items:center;">
    <span class="header-stats" id="headerStats">â€“</span>
    <a href="index.html" class="btn btn-sm btn-secondary">â†’ VeÅ™ejnÃ¡ strÃ¡nka</a>
  </div>
</header>

<div class="container">
  <!-- Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="events" onclick="switchTab('events')">ğŸ“… Eventy</button>
    <button class="tab" data-tab="regs" onclick="switchTab('regs')">ğŸ‘¥ Registrace</button>
  </div>

  <!-- Events tab -->
  <div id="tabEvents">
    <div class="section-top">
      <h3>VaÅ¡e eventy</h3>
      <button class="btn btn-primary" onclick="openEditor(null)">+ NovÃ½ event</button>
    </div>
    <div id="eventList"></div>
  </div>

  <!-- Registrations tab -->
  <div id="tabRegs" style="display:none;">
    <div class="section-top">
      <h3>Registrace (<span id="regCount">0</span>)</h3>
      <button class="btn btn-sm btn-secondary" onclick="exportCSV()">â¬‡ï¸ Export CSV</button>
    </div>
    <div class="filters" id="regFilters"></div>
    <div id="regList"></div>
  </div>
</div>

<!-- Event Editor Modal -->
<div class="modal-overlay" id="editorModal" style="display:none;">
  <div class="modal">
    <div class="modal-box">
      <div class="modal-header">
        <h3 id="editorTitle">NovÃ½ event</h3>
        <button class="modal-close" onclick="closeEditor()">âœ•</button>
      </div>
      <div class="modal-body">
        <!-- Editor tabs -->
        <div class="editor-tabs">
          <button class="editor-tab active" data-etab="basic" onclick="switchEditorTab('basic')">ğŸ“ ZÃ¡kladnÃ­ info</button>
          <button class="editor-tab" data-etab="program" onclick="switchEditorTab('program')">ğŸ“‹ Program</button>
          <button class="editor-tab" data-etab="design" onclick="switchEditorTab('design')">ğŸ¨ Design & pole</button>
        </div>

        <!-- Basic info -->
        <div id="etabBasic">
          <div class="form-group">
            <label class="form-label">Typ eventu <span class="req">*</span></label>
            <div class="type-options" id="typeOptions"></div>
          </div>
          <div class="form-group form-full">
            <label class="form-label">NÃ¡zev eventu <span class="req">*</span></label>
            <input class="form-input" id="evtName" placeholder="napÅ™. Å KODA X Innovation Day 2026">
          </div>
          <div class="form-row">
            <div class="form-group"><label class="form-label">Datum od <span class="req">*</span></label><input class="form-input" type="date" id="evtDate"></div>
            <div class="form-group"><label class="form-label">Datum do (volitelnÃ©)</label><input class="form-input" type="date" id="evtDateEnd"></div>
            <div class="form-group"><label class="form-label">ÄŒas od</label><input class="form-input" type="time" id="evtTime" value="09:00"></div>
            <div class="form-group"><label class="form-label">ÄŒas do</label><input class="form-input" type="time" id="evtTimeEnd" value="18:00"></div>
          </div>
          <div class="form-group">
            <label class="form-label">MÃ­sto konÃ¡nÃ­ <span class="req">*</span></label>
            <input class="form-input" id="evtLocation" placeholder="Forum KarlÃ­n, Praha">
          </div>
          <div class="form-group">
            <label class="form-label">Popis eventu</label>
            <textarea class="form-input" id="evtDesc" rows="3" placeholder="PopiÅ¡te o Äem event bude, pro koho je urÄenÃ½..."></textarea>
          </div>
          <div class="form-group">
            <label class="form-label">URL fotografie / banneru</label>
            <input class="form-input" id="evtPhoto" placeholder="https://images.unsplash.com/..." oninput="previewPhoto()">
          </div>
          <div class="photo-preview" id="photoPreview" style="display:none;"><img id="photoImg" src="" alt=""></div>
          <div class="form-row">
            <div class="form-group">
              <label class="form-label">Kapacita</label>
              <input class="form-input" type="number" id="evtCapacity" placeholder="200">
            </div>
            <div class="form-group">
              <label class="form-label">Status</label>
              <div class="status-row">
                <button class="status-btn on" id="statusPub" onclick="setStatus(true)">âœ“ PublikovÃ¡no</button>
                <button class="status-btn" id="statusDraft" onclick="setStatus(false)">â¸ Koncept</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Program -->
        <div id="etabProgram" style="display:none;">
          <p style="color:rgba(255,255,255,0.4);font-size:13px;margin-bottom:18px;">
            PÅ™idejte programovÃ© bloky / pÅ™ednÃ¡Å¡ky / workshopy, ze kterÃ½ch si ÃºÄastnÃ­ci budou moci vybÃ­rat.
          </p>
          <div id="programList"></div>
          <button class="btn btn-secondary" onclick="addProgram()">+ PÅ™idat programovÃ½ blok</button>
        </div>

        <!-- Design & fields -->
        <div id="etabDesign" style="display:none;">
          <div class="form-group">
            <label class="form-label">BarevnÃ© tÃ©ma</label>
            <div class="theme-options" id="themeOptions"></div>
          </div>
          <div class="form-group">
            <label class="form-label">Pole ve formulÃ¡Å™i</label>
            <p style="color:rgba(255,255,255,0.35);font-size:12px;margin-bottom:12px;">JmÃ©no a email jsou vÅ¾dy povinnÃ©. Zvolte dalÅ¡Ã­ pole:</p>
            <div class="field-grid" id="fieldToggles"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeEditor()">ZruÅ¡it</button>
        <button class="btn btn-primary" onclick="saveEvent()">UloÅ¾it</button>
      </div>
    </div>
  </div>
</div>

<!-- Delete confirmation -->
<div class="modal-overlay" id="deleteModal" style="display:none;">
  <div class="modal" style="max-width:420px;">
    <div class="modal-box">
      <div class="modal-header"><h3>Smazat event?</h3><button class="modal-close" onclick="closeDelete()">âœ•</button></div>
      <div class="modal-body">
        <p style="color:rgba(255,255,255,0.6);font-size:14px;line-height:1.6;">Opravdu chcete smazat tento event? Registrace budou zachovÃ¡ny, ale nebudou pÅ™iÅ™azeny k Å¾Ã¡dnÃ©mu eventu.</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeDelete()">ZruÅ¡it</button>
        <button class="btn btn-danger" onclick="confirmDelete()">ğŸ—‘ Smazat</button>
      </div>
    </div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA & CONFIG
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const STORE_EVENTS = 'skodax-events';
const STORE_REGS = 'skodax-registrations';

const EVENT_TYPES = {
  conference: { icon: 'ğŸ¤', label: 'Konference', color: '#78FAAE' },
  workshop:   { icon: 'ğŸ› ï¸', label: 'Workshop / Å kolenÃ­', color: '#4FC3F7' },
  meetup:     { icon: 'ğŸ¤', label: 'Networking / Meetup', color: '#FFB74D' },
};

const THEMES = [
  { id: 'green',  name: 'Å KODA Green',       primary: '#78FAAE', bg: '#0d1f15' },
  { id: 'blue',   name: 'Electric Blue',     primary: '#4FC3F7', bg: '#0d1520' },
  { id: 'orange', name: 'Warm Orange',        primary: '#FFB74D', bg: '#1f150d' },
  { id: 'purple', name: 'Innovation Purple',  primary: '#CE93D8', bg: '#1a0d20' },
  { id: 'white',  name: 'Clean White',        primary: '#78FAAE', bg: '#f5f5f5' },
];

const FORM_FIELDS = [
  { key: 'phone', label: 'Telefon' },
  { key: 'company', label: 'Firma / organizace' },
  { key: 'position', label: 'Pozice' },
  { key: 'dietary', label: 'PoznÃ¡mka (strava, alergie)' },
];

function load(key) { try { return JSON.parse(localStorage.getItem(key)) || []; } catch { return []; } }
function save(key, data) { localStorage.setItem(key, JSON.stringify(data)); }

let events = load(STORE_EVENTS);
let registrations = load(STORE_REGS);

// Seed demo events (v2 = 6 events)
const SEED_VERSION = 'skodax-seed-v3';
if (!localStorage.getItem(SEED_VERSION)) {
  localStorage.setItem(SEED_VERSION, '1');
  events = []; // Clear old data to reseed
  events = [
    {
      id: 'evt-demo-1', type: 'conference', name: 'Å KODA X Innovation Day 2026',
      date: '2026-04-15', dateEnd: '', time: '09:00', timeEnd: '18:00',
      location: 'Forum KarlÃ­n, Praha',
      description: 'CelodennÃ­ konference o inovacÃ­ch v mobilitÄ›, AI a digitÃ¡lnÃ­ transformaci. PÅ™ijÄte se inspirovat pÅ™ednÃ¡Å¡kami expertÅ¯ a networkovat s kolegy z branÅ¾e.',
      photoUrl: 'https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=800&q=80',
      theme: 'green', capacity: 200, published: true,
      programs: [
        { id: 'p1', name: 'Keynote: Budoucnost mobility', time: '09:00', timeEnd: '10:30', speaker: 'CEO Å KODA X', capacity: '' },
        { id: 'p2', name: 'Panel: AI v automotive', time: '11:00', timeEnd: '12:00', speaker: '', capacity: '' },
        { id: 'p3', name: 'Workshop: GEO strategie', time: '13:30', timeEnd: '15:00', speaker: '', capacity: '30' },
      ],
      fields: { phone: true, company: true, position: true, dietary: true },
      createdAt: new Date().toISOString(),
    },
    {
      id: 'evt-demo-2', type: 'workshop', name: 'AI pro marketing â€“ Hands-on Å¡kolenÃ­',
      date: '2026-05-08', dateEnd: '', time: '09:00', timeEnd: '16:00',
      location: 'Å KODA X Hub, MladÃ¡ Boleslav',
      description: 'CelodennÃ­ praktickÃ½ workshop zamÄ›Å™enÃ½ na vyuÅ¾itÃ­ AI nÃ¡strojÅ¯ v marketingu. NauÄÃ­te se pracovat s generativnÃ­ AI pro tvorbu obsahu, analÃ½zu dat a automatizaci kampanÃ­.',
      photoUrl: 'https://images.unsplash.com/photo-1531482615713-2afd69097998?w=800&q=80',
      theme: 'blue', capacity: 25, published: true,
      programs: [
        { id: 'p4', name: 'AI copywriting â€“ od briefu po finÃ¡lnÃ­ text', time: '09:00', timeEnd: '10:30', speaker: 'David MareÅ¡', capacity: '25' },
        { id: 'p5', name: 'Prompt engineering pro marketÃ©ry', time: '11:00', timeEnd: '12:30', speaker: 'David MareÅ¡', capacity: '25' },
        { id: 'p6', name: 'AI vizuÃ¡ly a video â€“ praktickÃ¡ dÃ­lna', time: '13:30', timeEnd: '15:00', speaker: 'TomÃ¡Å¡ HrubÃ½', capacity: '25' },
        { id: 'p7', name: 'Automatizace reportingu s AI', time: '15:15', timeEnd: '16:00', speaker: 'Petra KovÃ¡Å™ovÃ¡', capacity: '25' },
      ],
      fields: { phone: true, company: true, position: true, dietary: true },
      createdAt: new Date().toISOString(),
    },
    {
      id: 'evt-demo-3', type: 'meetup', name: 'EV Community Meetup Praha',
      date: '2026-05-22', dateEnd: '', time: '17:30', timeEnd: '21:00',
      location: 'Manifesto Market Florenc, Praha',
      description: 'NeformÃ¡lnÃ­ setkÃ¡nÃ­ komunity elektromobilistÅ¯ a nadÅ¡encÅ¯ do e-mobility. SdÃ­lejte zkuÅ¡enosti, prohlÃ©dnÄ›te si nejnovÄ›jÅ¡Ã­ modely a poznejte novÃ© lidi ze scÃ©ny.',
      photoUrl: 'https://images.unsplash.com/photo-1511578314322-379afb476865?w=800&q=80',
      theme: 'orange', capacity: 80, published: true,
      programs: [
        { id: 'p8', name: 'Speed networking', time: '17:30', timeEnd: '18:15', speaker: '', capacity: '' },
        { id: 'p9', name: 'Lightning talks â€“ zkuÅ¡enosti s EV', time: '18:30', timeEnd: '19:30', speaker: 'Community speakers', capacity: '' },
        { id: 'p10', name: 'Fireside chat: Budoucnost nabÃ­jenÃ­ v ÄŒR', time: '19:30', timeEnd: '20:15', speaker: 'Jan Å vÃ¡b, ÄŒEZ', capacity: '' },
        { id: 'p11', name: 'Drinks & networking', time: '20:15', timeEnd: '21:00', speaker: '', capacity: '' },
      ],
      fields: { phone: false, company: false, position: false, dietary: false },
      createdAt: new Date().toISOString(),
    },
    {
      id: 'evt-demo-4', type: 'conference', name: 'Digital Transformation Summit 2026',
      date: '2026-06-12', dateEnd: '2026-06-13', time: '08:30', timeEnd: '17:00',
      location: 'O2 Universum, Praha',
      description: 'DvoudennÃ­ summit o digitÃ¡lnÃ­ transformaci v automobilovÃ©m prÅ¯myslu. Keynote pÅ™ednÃ¡Å¡ky od lÃ­drÅ¯ z VW Group, panelovÃ© diskuze o datech, AI a zÃ¡kaznickÃ© zkuÅ¡enosti.',
      photoUrl: 'https://images.unsplash.com/photo-1505373877841-8d25f7d46678?w=800&q=80',
      theme: 'purple', capacity: 500, published: true,
      programs: [
        { id: 'p12', name: 'Keynote: Digital-first strategie VW Group', time: '09:00', timeEnd: '10:00', speaker: 'CTO Volkswagen AG', capacity: '' },
        { id: 'p13', name: 'Panel: Data-driven rozhodovÃ¡nÃ­', time: '10:30', timeEnd: '11:30', speaker: '', capacity: '' },
        { id: 'p14', name: 'Workshop: Customer journey mapping', time: '13:00', timeEnd: '14:30', speaker: 'UX tÃ½m Å KODA X', capacity: '40' },
        { id: 'p15', name: 'Panel: Connected car & OTA updates', time: '15:00', timeEnd: '16:00', speaker: '', capacity: '' },
        { id: 'p16', name: 'Networking dinner (Den 1)', time: '18:00', timeEnd: '21:00', speaker: '', capacity: '150' },
        { id: 'p17', name: 'Hackathon: Mobility of Tomorrow (Den 2)', time: '09:00', timeEnd: '16:00', speaker: '', capacity: '60' },
      ],
      fields: { phone: true, company: true, position: true, dietary: true },
      createdAt: new Date().toISOString(),
    },
    {
      id: 'evt-demo-5', type: 'workshop', name: 'Brand Visibility v AI systÃ©mech',
      date: '2026-06-26', dateEnd: '', time: '10:00', timeEnd: '14:00',
      location: 'Impact Hub, Praha',
      description: 'Jak se vaÅ¡e znaÄka zobrazuje v ChatGPT, Claude, Perplexity a dalÅ¡Ã­ch AI platformÃ¡ch? Workshop zamÄ›Å™enÃ½ na Answer Engine Optimization (AEO) a Generative Engine Optimization (GEO).',
      photoUrl: 'https://images.unsplash.com/photo-1677442136019-21780ecad995?w=800&q=80',
      theme: 'green', capacity: 30, published: true,
      programs: [
        { id: 'p18', name: 'Jak AI platformy vybÃ­rajÃ­ znaÄky', time: '10:00', timeEnd: '11:00', speaker: 'David MareÅ¡, Å KODA X', capacity: '30' },
        { id: 'p19', name: 'Audit vaÅ¡Ã­ znaÄky v AI â€“ praktickÃ© cviÄenÃ­', time: '11:15', timeEnd: '12:15', speaker: 'David MareÅ¡, Å KODA X', capacity: '30' },
        { id: 'p20', name: 'AEO & GEO strategie â€“ akÄnÃ­ plÃ¡n', time: '12:45', timeEnd: '14:00', speaker: 'David MareÅ¡, Å KODA X', capacity: '30' },
      ],
      fields: { phone: true, company: true, position: true, dietary: false },
      createdAt: new Date().toISOString(),
    },
    {
      id: 'evt-demo-6', type: 'meetup', name: 'Å KODA X After Work â€“ LetnÃ­ edice',
      date: '2026-07-10', dateEnd: '', time: '16:00', timeEnd: '20:00',
      location: 'StÅ™echa Lucerny, Praha',
      description: 'LetnÃ­ neformÃ¡lnÃ­ setkÃ¡nÃ­ tÃ½mu Å KODA X a partnerÅ¯. GrilovÃ¡nÃ­ na stÅ™eÅ¡e, demo ukÃ¡zky novÃ½ch projektÅ¯ a pÅ™Ã­jemnÃ¡ atmosfÃ©ra s vÃ½hledem na Prahu.',
      photoUrl: 'https://images.unsplash.com/photo-1533174072545-7a4b6ad7a6c3?w=800&q=80',
      theme: 'orange', capacity: 60, published: true,
      programs: [
        { id: 'p21', name: 'Welcome drink & grill', time: '16:00', timeEnd: '17:00', speaker: '', capacity: '' },
        { id: 'p22', name: 'Demo corner â€“ novÃ© projekty Å KODA X', time: '17:00', timeEnd: '18:30', speaker: 'TÃ½m Å KODA X', capacity: '' },
        { id: 'p23', name: 'Sunset talks & networking', time: '18:30', timeEnd: '20:00', speaker: '', capacity: '' },
      ],
      fields: { phone: false, company: true, position: false, dietary: true },
      createdAt: new Date().toISOString(),
    },
  ];
  save(STORE_EVENTS, events);

  // Generate demo registrations (~half capacity per event)
  const firstNames = ['Jan','Petr','Martin','TomÃ¡Å¡','LukÃ¡Å¡','David','Jakub','VojtÄ›ch','Adam','OndÅ™ej','Filip','Marek','Michal','Daniel','Pavel','Anna','Eva','KateÅ™ina','Lucie','Tereza','Petra','Barbora','Monika','Hana','Lenka','Veronika','Zuzana','KlÃ¡ra','MarkÃ©ta','Simona'];
  const lastNames = ['NovÃ¡k','Svoboda','NovotnÃ½','DvoÅ™Ã¡k','ÄŒernÃ½','ProchÃ¡zka','KuÄera','VeselÃ½','HorÃ¡k','NÄ›mec','MarkovÃ¡','PokornÃ¡','PospÃ­Å¡ilovÃ¡','HÃ¡jkovÃ¡','KrÃ¡lovÃ¡','JelÃ­nkovÃ¡','Å˜eznÃ­ÄkovÃ¡','SedlÃ¡ÄkovÃ¡','UrbanovÃ¡','MalÃ¡','BlaÅ¾ek','Fiala','Å Å¥astnÃ½','KolÃ¡Å™','NavrÃ¡til'];
  const companies = ['Å koda Auto','T-Mobile CZ','KomerÄnÃ­ banka','Alza.cz','Seznam.cz','Avast','Rohlik.cz','CDN77','JetBrains','Red Hat CZ','SAP CZ','Accenture CZ','McKinsey Praha','Deloitte CZ','ÄŒSOB','ÄŒeskÃ¡ spoÅ™itelna','O2 Czech Republic','Vodafone CZ','Microsoft CZ','Google CZ'];
  const positions = ['Marketing Manager','Digital Specialist','Brand Manager','CMO','Head of Marketing','Product Manager','Data Analyst','UX Designer','CEO','CTO','Innovation Lead','PR Manager','Content Strategist','Growth Hacker','Business Developer','Project Manager','Team Lead','Senior Developer','AI Specialist','Community Manager'];
  const pick = arr => arr[Math.floor(Math.random() * arr.length)];

  const demoRegs = [];
  events.forEach(evt => {
    const cap = parseInt(evt.capacity) || 40;
    const count = Math.floor(cap * 0.45) + Math.floor(Math.random() * Math.floor(cap * 0.15));
    for (let i = 0; i < count; i++) {
      const fn = pick(firstNames);
      const ln = pick(lastNames);
      const email = (fn.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'') + '.' + ln.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'') + '@' + pick(['gmail.com','seznam.cz','firma.cz','outlook.cz','email.cz']));
      const reg = {
        id: 'reg-seed-' + evt.id + '-' + i,
        eventId: evt.id,
        name: fn + ' ' + ln,
        email: email,
        phone: evt.fields?.phone ? ('+420 ' + (600 + Math.floor(Math.random()*400)) + ' ' + String(Math.floor(Math.random()*900)+100) + ' ' + String(Math.floor(Math.random()*900)+100)) : '',
        company: evt.fields?.company ? pick(companies) : '',
        position: evt.fields?.position ? pick(positions) : '',
        programs: (evt.programs || []).filter(() => Math.random() > 0.4).map(p => p.id),
        dietaryNotes: evt.fields?.dietary ? (Math.random() > 0.85 ? pick(['VegetariÃ¡n','Vegan','BezlepkovÃ¡ dieta','Bez laktÃ³zy','Alergie na oÅ™echy']) : '') : '',
        timestamp: new Date(Date.now() - Math.floor(Math.random() * 30*24*60*60*1000)).toISOString(),
      };
      demoRegs.push(reg);
    }
  });
  registrations = demoRegs;
  save(STORE_REGS, registrations);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let currentTab = 'events';

function switchTab(tab) {
  currentTab = tab;
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  document.getElementById('tabEvents').style.display = tab === 'events' ? '' : 'none';
  document.getElementById('tabRegs').style.display = tab === 'regs' ? '' : 'none';
  if (tab === 'regs') renderRegistrations();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENT LIST
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function renderEvents() {
  const el = document.getElementById('eventList');
  updateStats();

  if (events.length === 0) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ“…</div><p>ZatÃ­m nemÃ¡te Å¾Ã¡dnÃ© eventy</p><button class="btn btn-primary" onclick="openEditor(null)">VytvoÅ™it prvnÃ­ event</button></div>';
    return;
  }

  el.innerHTML = events.map(evt => {
    const meta = EVENT_TYPES[evt.type] || EVENT_TYPES.conference;
    const regCount = registrations.filter(r => r.eventId === evt.id).length;
    const borderClass = evt.type === 'conference' ? 'border-left-green' : evt.type === 'workshop' ? 'border-left-blue' : 'border-left-orange';
    const dateStr = evt.date ? new Date(evt.date + 'T00:00').toLocaleDateString('cs-CZ', { day: 'numeric', month: 'long', year: 'numeric' }) : 'â€“';

    return `
    <div class="event-card ${borderClass}">
      ${evt.photoUrl ? `<img class="event-card-photo" src="${esc(evt.photoUrl)}" alt="" onerror="this.style.display='none'">` : ''}
      <div class="event-card-body">
        <div>
          <div class="event-card-tags">
            <span class="tag" style="background:${meta.color}18;color:${meta.color}">${meta.icon} ${meta.label}</span>
            <span class="tag" style="background:${evt.published ? 'rgba(120,250,174,0.12);color:#78FAAE' : 'rgba(255,183,77,0.12);color:#FFB74D'}">${evt.published ? 'âœ“ PublikovÃ¡no' : 'â¸ Koncept'}</span>
            <span class="tag" style="background:var(--d3);color:rgba(255,255,255,0.5)">${regCount} registracÃ­${evt.capacity ? ' / ' + evt.capacity : ''}</span>
          </div>
          <h4>${esc(evt.name)}</h4>
          <div class="event-card-meta">
            ğŸ“ ${esc(evt.location)} &nbsp;Â·&nbsp; ğŸ“… ${dateStr}
            ${evt.time ? ` Â· ğŸ• ${evt.time}â€“${evt.timeEnd || '?'}` : ''}
            ${evt.programs?.length ? ` Â· ğŸ“‹ ${evt.programs.length} blokÅ¯` : ''}
          </div>
        </div>
        <div class="event-card-actions">
          <button class="btn btn-sm btn-secondary" onclick="openEditor('${evt.id}')">âœï¸ Upravit</button>
          <button class="btn btn-sm btn-ghost" onclick="duplicateEvent('${evt.id}')">ğŸ“‹ Duplikovat</button>
          <button class="btn btn-sm btn-ghost" onclick="openDelete('${evt.id}')">ğŸ—‘</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function updateStats() {
  document.getElementById('headerStats').textContent = `${events.length} eventÅ¯ Â· ${registrations.length} registracÃ­`;
}

function esc(str) { const d = document.createElement('div'); d.textContent = str || ''; return d.innerHTML; }

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// EVENT EDITOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let editingEvent = null;
let editorData = {};

function openEditor(id) {
  if (id) {
    editingEvent = events.find(e => e.id === id);
    editorData = JSON.parse(JSON.stringify(editingEvent));
    document.getElementById('editorTitle').textContent = 'Upravit event';
  } else {
    editingEvent = null;
    editorData = {
      id: 'evt-' + Date.now(), type: 'conference', name: '', date: '', dateEnd: '', time: '09:00', timeEnd: '18:00',
      location: '', description: '', photoUrl: '', theme: 'green', capacity: '', published: false,
      programs: [], fields: { phone: true, company: true, position: true, dietary: true },
      createdAt: new Date().toISOString(),
    };
    document.getElementById('editorTitle').textContent = 'NovÃ½ event';
  }
  populateEditor();
  switchEditorTab('basic');
  document.getElementById('editorModal').style.display = '';
}

function closeEditor() {
  document.getElementById('editorModal').style.display = 'none';
}

function switchEditorTab(tab) {
  // Save current fields first
  readEditorFields();
  document.querySelectorAll('.editor-tab').forEach(t => t.classList.toggle('active', t.dataset.etab === tab));
  document.getElementById('etabBasic').style.display = tab === 'basic' ? '' : 'none';
  document.getElementById('etabProgram').style.display = tab === 'program' ? '' : 'none';
  document.getElementById('etabDesign').style.display = tab === 'design' ? '' : 'none';
  if (tab === 'program') renderProgramEditor();
  if (tab === 'design') renderDesignTab();
}

function populateEditor() {
  const d = editorData;
  // Type buttons
  document.getElementById('typeOptions').innerHTML = Object.entries(EVENT_TYPES).map(([k, v]) =>
    `<button class="type-btn ${d.type === k ? 'active' : ''}" onclick="setType('${k}')">${v.icon} ${v.label}</button>`
  ).join('');

  document.getElementById('evtName').value = d.name || '';
  document.getElementById('evtDate').value = d.date || '';
  document.getElementById('evtDateEnd').value = d.dateEnd || '';
  document.getElementById('evtTime').value = d.time || '09:00';
  document.getElementById('evtTimeEnd').value = d.timeEnd || '18:00';
  document.getElementById('evtLocation').value = d.location || '';
  document.getElementById('evtDesc').value = d.description || '';
  document.getElementById('evtPhoto').value = d.photoUrl || '';
  document.getElementById('evtCapacity').value = d.capacity || '';
  setStatus(d.published);
  previewPhoto();
}

function setType(type) {
  editorData.type = type;
  document.querySelectorAll('.type-btn').forEach(b => b.classList.toggle('active', b.textContent.includes(EVENT_TYPES[type].label)));
}

function setStatus(pub) {
  editorData.published = pub;
  document.getElementById('statusPub').className = 'status-btn' + (pub ? ' on' : '');
  document.getElementById('statusDraft').className = 'status-btn' + (!pub ? ' off' : '');
}

function previewPhoto() {
  const url = document.getElementById('evtPhoto').value.trim();
  const preview = document.getElementById('photoPreview');
  if (url) {
    document.getElementById('photoImg').src = url;
    document.getElementById('photoImg').onerror = () => { preview.style.display = 'none'; };
    preview.style.display = '';
  } else {
    preview.style.display = 'none';
  }
}

function readEditorFields() {
  editorData.name = document.getElementById('evtName').value;
  editorData.date = document.getElementById('evtDate').value;
  editorData.dateEnd = document.getElementById('evtDateEnd').value;
  editorData.time = document.getElementById('evtTime').value;
  editorData.timeEnd = document.getElementById('evtTimeEnd').value;
  editorData.location = document.getElementById('evtLocation').value;
  editorData.description = document.getElementById('evtDesc').value;
  editorData.photoUrl = document.getElementById('evtPhoto').value;
  editorData.capacity = document.getElementById('evtCapacity').value;
}

// â”€â”€â”€ Program editor â”€â”€â”€

function renderProgramEditor() {
  const el = document.getElementById('programList');
  el.innerHTML = editorData.programs.map((p, i) => `
    <div class="prog-block">
      <div class="prog-remove"><button class="btn btn-ghost btn-sm" onclick="removeProgram(${i})">ğŸ—‘</button></div>
      <div class="form-group"><label class="form-label">NÃ¡zev bloku</label><input class="form-input prog-name" data-i="${i}" value="${esc(p.name)}" placeholder="Keynote pÅ™ednÃ¡Å¡ka" oninput="updProg(${i},'name',this.value)"></div>
      <div class="form-row-3">
        <div class="form-group"><label class="form-label">ÄŒas od</label><input class="form-input" type="time" value="${p.time || ''}" oninput="updProg(${i},'time',this.value)"></div>
        <div class="form-group"><label class="form-label">ÄŒas do</label><input class="form-input" type="time" value="${p.timeEnd || ''}" oninput="updProg(${i},'timeEnd',this.value)"></div>
        <div class="form-group"><label class="form-label">Kapacita</label><input class="form-input" type="number" value="${p.capacity || ''}" placeholder="âˆ" oninput="updProg(${i},'capacity',this.value)"></div>
      </div>
      <div class="form-group" style="margin-bottom:0;"><label class="form-label">Å˜eÄnÃ­k / lektor</label><input class="form-input" value="${esc(p.speaker || '')}" placeholder="JmÃ©no (volitelnÃ©)" oninput="updProg(${i},'speaker',this.value)"></div>
    </div>
  `).join('');
}

function addProgram() {
  editorData.programs.push({ id: 'prog-' + Date.now(), name: '', time: '09:00', timeEnd: '10:00', speaker: '', capacity: '' });
  renderProgramEditor();
}

function removeProgram(i) {
  editorData.programs.splice(i, 1);
  renderProgramEditor();
}

function updProg(i, key, val) {
  editorData.programs[i][key] = val;
}

// â”€â”€â”€ Design tab â”€â”€â”€

function renderDesignTab() {
  document.getElementById('themeOptions').innerHTML = THEMES.map(t =>
    `<button class="theme-btn ${editorData.theme === t.id ? 'active' : ''}" onclick="setTheme('${t.id}')">
      <div class="theme-dot" style="background:${t.primary}"></div>
      <span class="theme-name">${t.name}</span>
    </button>`
  ).join('');

  document.getElementById('fieldToggles').innerHTML = FORM_FIELDS.map(f =>
    `<div class="field-toggle ${editorData.fields?.[f.key] ? 'active' : ''}" onclick="toggleField('${f.key}')">
      <div class="field-check">${editorData.fields?.[f.key] ? 'âœ“' : ''}</div>
      <span class="field-name">${f.label}</span>
    </div>`
  ).join('');
}

function setTheme(id) {
  editorData.theme = id;
  renderDesignTab();
}

function toggleField(key) {
  if (!editorData.fields) editorData.fields = {};
  editorData.fields[key] = !editorData.fields[key];
  renderDesignTab();
}

// â”€â”€â”€ Save â”€â”€â”€

function saveEvent() {
  readEditorFields();
  // Validate
  if (!editorData.name.trim()) { alert('VyplÅˆte nÃ¡zev eventu'); return; }
  if (!editorData.date) { alert('VyplÅˆte datum'); return; }
  if (!editorData.location.trim()) { alert('VyplÅˆte mÃ­sto konÃ¡nÃ­'); return; }

  editorData.published = !!editorData.published;

  if (editingEvent) {
    events = events.map(e => e.id === editorData.id ? { ...editorData } : e);
  } else {
    events.push({ ...editorData });
  }
  save(STORE_EVENTS, events);
  closeEditor();
  renderEvents();
}

// â”€â”€â”€ Delete â”€â”€â”€

let deleteId = null;
function openDelete(id) { deleteId = id; document.getElementById('deleteModal').style.display = ''; }
function closeDelete() { document.getElementById('deleteModal').style.display = 'none'; deleteId = null; }
function confirmDelete() {
  if (deleteId) {
    events = events.filter(e => e.id !== deleteId);
    save(STORE_EVENTS, events);
    renderEvents();
  }
  closeDelete();
}

// â”€â”€â”€ Duplicate â”€â”€â”€

function duplicateEvent(id) {
  const src = events.find(e => e.id === id);
  if (!src) return;
  const dup = JSON.parse(JSON.stringify(src));
  dup.id = 'evt-' + Date.now();
  dup.name += ' (kopie)';
  dup.published = false;
  dup.createdAt = new Date().toISOString();
  events.push(dup);
  save(STORE_EVENTS, events);
  renderEvents();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// REGISTRATIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let regFilter = 'all';

function renderRegistrations() {
  registrations = load(STORE_REGS); // Refresh from storage
  updateStats();

  const filtered = regFilter === 'all' ? registrations : registrations.filter(r => r.eventId === regFilter);
  document.getElementById('regCount').textContent = filtered.length;

  // Filters
  let filtersHtml = `<button class="filter-pill ${regFilter === 'all' ? 'active' : ''}" onclick="setRegFilter('all')">VÅ¡e</button>`;
  events.forEach(evt => {
    filtersHtml += `<button class="filter-pill ${regFilter === evt.id ? 'active' : ''}" onclick="setRegFilter('${evt.id}')">${esc(evt.name)}</button>`;
  });
  document.getElementById('regFilters').innerHTML = filtersHtml;

  // List
  const el = document.getElementById('regList');
  if (filtered.length === 0) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ğŸ‘¥</div><p>Å½Ã¡dnÃ© registrace</p></div>';
    return;
  }

  el.innerHTML = filtered.map(reg => {
    const evt = events.find(e => e.id === reg.eventId);
    const meta = EVENT_TYPES[evt?.type] || EVENT_TYPES.conference;
    const borderClass = evt?.type === 'conference' ? 'border-left-green' : evt?.type === 'workshop' ? 'border-left-blue' : 'border-left-orange';

    let progsHtml = '';
    if (reg.programs?.length > 0 && evt?.programs) {
      progsHtml = '<div class="reg-programs">' + reg.programs.map(pId => {
        const prog = evt.programs.find(p => p.id === pId);
        return prog ? `<span class="reg-prog-tag">${esc(prog.name)}</span>` : '';
      }).join('') + '</div>';
    }

    return `
    <div class="reg-row ${borderClass}">
      <div class="reg-row-top">
        <div>
          <div class="reg-name">${esc(reg.name)}</div>
          <div class="reg-details">
            ${esc(reg.email)}${reg.phone ? ' Â· ' + esc(reg.phone) : ''}${reg.company ? ' Â· ' + esc(reg.company) : ''}${reg.position ? ' (' + esc(reg.position) + ')' : ''}
          </div>
        </div>
        <div style="text-align:right;">
          <span class="reg-event-tag" style="background:${meta.color}12;color:${meta.color}">${evt ? esc(evt.name) : 'â€“'}</span>
          <div class="reg-date">${new Date(reg.timestamp).toLocaleString('cs-CZ')}</div>
        </div>
      </div>
      ${progsHtml}
      ${reg.dietaryNotes ? `<p style="font-size:12px;color:rgba(255,255,255,0.35);margin-top:8px;font-style:italic;">ğŸ“ ${esc(reg.dietaryNotes)}</p>` : ''}
    </div>`;
  }).join('');
}

function setRegFilter(f) {
  regFilter = f;
  renderRegistrations();
}

function exportCSV() {
  const filtered = regFilter === 'all' ? registrations : registrations.filter(r => r.eventId === regFilter);
  const headers = ['Event', 'JmÃ©no', 'Email', 'Telefon', 'Firma', 'Pozice', 'Programy', 'PoznÃ¡mka', 'Datum registrace'];
  const rows = filtered.map(r => {
    const evt = events.find(e => e.id === r.eventId);
    return [
      evt?.name || '', r.name, r.email, r.phone || '', r.company || '', r.position || '',
      (r.programs || []).map(pId => evt?.programs?.find(p => p.id === pId)?.name || pId).join('; '),
      r.dietaryNotes || '', new Date(r.timestamp).toLocaleString('cs-CZ'),
    ];
  });
  const csv = [headers.join(','), ...rows.map(r => r.map(c => `"${(c + '').replace(/"/g, '""')}"`).join(','))].join('\n');
  const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `registrace-${new Date().toISOString().slice(0, 10)}.csv`;
  a.click();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

renderEvents();
</script>
</body>
</html>
